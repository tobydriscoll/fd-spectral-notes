
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>3.3. Iterative linear algebra &#8212; FD and Spectral methods for PDE</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"float": ["\\mathbb{F}"], "real": ["\\mathbb{R}"], "complex": ["\\mathbb{C}"], "nat": ["\\mathbb{N}"], "integer": ["\\mathbb{Z}"], "bfa": "\\mathbf{a}", "bfb": "\\mathbf{b}", "bfd": "\\mathbf{d}", "bfe": "\\mathbf{e}", "bff": "\\mathbf{f}", "bfx": "\\mathbf{x}", "bfX": "\\mathbf{X}", "bfA": "\\mathbf{A}", "bfJ": "\\mathbf{J}", "bfD": "\\mathbf{D}", "bfI": "\\mathbf{I}", "bfC": "\\mathbf{C}", "bfF": "\\mathbf{F}", "bfP": "\\mathbf{P}", "bfQ": "\\mathbf{Q}", "bfS": "\\mathbf{S}", "bfW": "\\mathbf{W}", "bfU": "\\mathbf{U}", "bfp": "\\mathbf{p}", "bfs": "\\mathbf{s}", "bfu": "\\mathbf{u}", "bfv": "\\mathbf{v}", "bfw": "\\mathbf{w}", "bfy": "\\mathbf{y}", "bfz": "\\mathbf{z}", "bfzero": "\\boldsymbol{0}", "bfmu": "\\boldsymbol{\\mu}", "bftau": "\\boldsymbol{\\tau}", "TP": "\\text{TP}", "TN": "\\text{TN}", "FP": "\\text{FP}", "FN": "\\text{FN}", "rmn": ["\\mathbb{R}^{#1 \\times #2}", 2], "dd": ["\\frac{d #1}{d #2}", 2], "pp": ["\\frac{\\partial #1}{\\partial #2}", 2], "norm": ["\\left\\lVert \\mathstrut #1 \\right\\rVert", 1], "abs": ["\\left\\lvert \\mathstrut #1 \\right\\rvert", 1], "twonorm": ["\\norm{#1}_2", 1], "onenorm": ["\\norm{#1}_1", 1], "infnorm": ["\\norm{#1}_\\infty", 1], "inprod": ["\\langle #1,#2 \\rangle", 2], "pr": ["^{(#1)}", 1], "diag": ["\\operatorname{diag}"], "sign": ["\\operatorname{sign}"], "mtx": ["\\operatorname{mtx}"], "dist": ["\\operatorname{dist}"], "myvec": ["\\operatorname{vec}"], "simil": ["\\operatorname{sim}"], "ee": ["\\times 10^"], "floor": ["\\lfloor#1\\rfloor", 1], "argmin": ["\\operatorname{argmin}"], "epsm": ["\\epsilon_{\\text{mach}}"], "logit": ["\\operatorname{logit}"]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.4. Discretizing the disk" href="disk.html" />
    <link rel="prev" title="3.2. Solving the Poisson equation" href="poisson.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">FD and Spectral methods for PDE</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Finite differences and spectral methods for PDEs
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../finite-diffs/overview.html">
   1. Finite differences
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../finite-diffs/integration.html">
     1.1. Indefinite integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../finite-diffs/series.html">
     1.2. Power series and finite differences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../finite-diffs/roundoff.html">
     1.3. Roundoff error
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../finite-diffs/fourier.html">
     1.4. Fourier analysis of finite differences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../finite-diffs/interpolation.html">
     1.5. Interpolation and finite differences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../finite-diffs/diffmats.html">
     1.6. Differentiation matrices
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tpbvp/overview.html">
   2. TPBVP
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tpbvp/linear.html">
     2.1. Two-point boundary-value problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tpbvp/bc.html">
     2.2. Boundary conditions for the TPBVP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tpbvp/nonlinear.html">
     2.3. Nonlinear TPBVP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tpbvp/layers.html">
     2.4. Resolving layers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tpbvp/bootstrap.html">
     2.5. Bootstrapping methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="overview.html">
   3. Elliptic PDE
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="tensorproduct.html">
     3.1. Tensor-product grids
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="poisson.html">
     3.2. Solving the Poisson equation
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     3.3. Iterative linear algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="disk.html">
     3.4. Discretizing the disk
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="decomp.html">
     3.5. Domain decomposition
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol/overview.html">
   4. Method of lines
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol/ivp.html">
     4.1. Multistep and RK methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol/stability.html">
     4.2. Absolute stability
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol/semidiscretization.html">
     4.3. Semidiscretization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol/beyond.html">
     4.4. Beyond the basics
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/tobydriscoll/fd-spectral-notes/main?urlpath=tree/elliptic/iterative.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/elliptic/iterative.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="../_sources/elliptic/iterative.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#splitting-methods">
   Splitting methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#krylov-methods">
   Krylov methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preconditioning">
   Preconditioning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#newton-krylov-methods">
   Newton–Krylov methods
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Iterative linear algebra</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#splitting-methods">
   Splitting methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#krylov-methods">
   Krylov methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preconditioning">
   Preconditioning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#newton-krylov-methods">
   Newton–Krylov methods
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="iterative-linear-algebra">
<h1><span class="section-number">3.3. </span>Iterative linear algebra<a class="headerlink" href="#iterative-linear-algebra" title="Permalink to this headline">#</a></h1>
<p>Even exploiting sparsity, the time to solve a linear system for an elliptic PDE quickly becomes unreasonable as the grid size increases. In terms of the grid spacing <span class="math notranslate nohighlight">\(h\)</span>, the number of unknowns scales as <span class="math notranslate nohighlight">\(O(h^{-2})\)</span> and the time per linear system solution is <span class="math notranslate nohighlight">\(O(h^{-4})\)</span>. With a convergence rate of 2nd order, a 10-fold decrease in the error requires <span class="math notranslate nohighlight">\(h\)</span> to decrease by a factor of <span class="math notranslate nohighlight">\(3.3\)</span> and the execution time goes up by a factor of about 120. The situation is even more unmanageable in 3D, where the solution time scales with <span class="math notranslate nohighlight">\(O(h^{-6})\)</span>.</p>
<p>There’s something unsatisfying about solving a linear system exactly (modulo roundoff) when the solution is itself a low-accuracy representation of the continuous object that is the real target. In other words, if a nodal value has only 3 accurate digits, we don’t care that the solution of the discrete system is 0.123456787654, as we are just as happy with 0.123. But factorization-based linear solvers don’t give us a choice in the matter.</p>
<p>Thus, as the number of unknowns grows, we seek iterative methods to solve the linear systems. We can stop the iterations once we have as much accuracy as we hope to get from the discretization, potentially saving a lot of time.</p>
<section id="splitting-methods">
<h2>Splitting methods<a class="headerlink" href="#splitting-methods" title="Permalink to this headline">#</a></h2>
<p>The OG iterative methods for linear systems are known as <strong>splitting methods</strong>. We rewrite the system matrix as <span class="math notranslate nohighlight">\(\bfA=\mathbf{M}-\mathbf{N}\)</span>, and <span class="math notranslate nohighlight">\(\bfA\bfu=\bfb\)</span> as</p>
<div class="math notranslate nohighlight">
\[
\mathbf{M} \bfu = \mathbf{N} \bfu + \bfb. 
\]</div>
<p>We then perform a fixed-point iteration</p>
<div class="math notranslate nohighlight">
\[
\mathbf{M} \bfu_{k+1} = \mathbf{N} \bfu_k + \bfb. 
\]</div>
<p>Clearly this is designed to use a matrix <span class="math notranslate nohighlight">\(\mathbf{M}\)</span> that makes it easy to solve the FP systems quickly. The most famous methods are <strong>Jacobi</strong>, which uses</p>
<div class="math notranslate nohighlight">
\[
\mathbf{M} = \diag(\diag(\bfA)), 
\]</div>
<p>and <strong>Gauss–Seidel</strong>, which lets <span class="math notranslate nohighlight">\(\mathbf{M}\)</span> be the lower triangle of <span class="math notranslate nohighlight">\(\bfA\)</span>. The convergence of the method depends on convergence of powers of <span class="math notranslate nohighlight">\(\mathbf{M}^{-1}\mathbf{N}\)</span> to zero. For a few cases, including Poisson’s equation, this convergence is well-understood, to an extent that allows a better variant called <em>SOR</em>.</p>
<p>The only reasons to use splitting methods are (a) for a <em>multigrid</em> method, which uses the convergence properties cleverly, and/or (b) massively parallel implementations of Jacobi, for which the components of <span class="math notranslate nohighlight">\(\bfu_{k+1}\)</span> may be computed independently.</p>
</section>
<section id="krylov-methods">
<h2>Krylov methods<a class="headerlink" href="#krylov-methods" title="Permalink to this headline">#</a></h2>
<p>In most contexts the preferred iterative methods are <strong>Krylov subspace iterations</strong>. For particular problem types, the best-known choices are</p>
<ul class="simple">
<li><p>Any matrix: GMRES</p></li>
<li><p>Symmetric matrix: MINRES</p></li>
<li><p>SPD matrix: Conjugate gradients (though MINRES is fine)</p></li>
</ul>
<p>There are many others, such as QMR, Bi-CGStab, etc.</p>
<p>All of the methods look for a solution of <span class="math notranslate nohighlight">\(\bfA\bfu=\bfb\)</span> in the nested subspaces spanned by <span class="math notranslate nohighlight">\(\bfb,\bfA\bfb,\bfA^2\bfb,\dots\)</span>. They use different iterations to generate them and to find the optimal solution for different definitions of optimality.</p>
<p>One extremely useful aspect of these methods is that the only way they use the matrix <span class="math notranslate nohighlight">\(\bfA\)</span> is by computing the matrix product <span class="math notranslate nohighlight">\(\bfA\bfv\)</span> for an arbitrary vector <span class="math notranslate nohighlight">\(\bfv\)</span>. That is, they just apply the linear transformation implied by <span class="math notranslate nohighlight">\(\bfA\)</span>. This enables <strong>matrix-free iterations</strong> in which <span class="math notranslate nohighlight">\(\bfA\)</span> is never explicitly assembled.</p>
<p>Let’s revisit the Poisson equation with <span class="math notranslate nohighlight">\(f=\Delta u = -\sin(3xy-4y)\bigl(9y^2+(3x-4)^2\bigr)\)</span> for the forcing function and <span class="math notranslate nohighlight">\(g=\sin(3xy-4y)\)</span> on the boundary, which has <span class="math notranslate nohighlight">\(g\)</span> as the solution everywhere.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="mi">3</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">4</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="mi">9</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="mi">3</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">sin</span><span class="p">(</span><span class="mi">3</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">4</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">xspan</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span>  <span class="n">yspan</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">];</span>
</pre></div>
</div>
</div>
</div>
<p>Most of the problem setup is the same as for the direct system method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span><span class="mi">60</span> 
<span class="n">include</span><span class="p">(</span><span class="s">&quot;diffmats.jl&quot;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">Dx</span><span class="p">,</span><span class="n">Dxx</span> <span class="o">=</span> <span class="n">diffmats</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">xspan</span><span class="o">...</span><span class="p">)</span>
<span class="n">y</span><span class="p">,</span><span class="n">Dy</span><span class="p">,</span><span class="n">Dyy</span> <span class="o">=</span> <span class="n">diffmats</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">yspan</span><span class="o">...</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="k">in</span> <span class="n">y</span><span class="p">]</span>

<span class="c"># Identify boundary locations.</span>
<span class="n">isboundary</span> <span class="o">=</span> <span class="n">trues</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">isboundary</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="n">m</span><span class="p">,</span><span class="mi">2</span><span class="o">:</span><span class="n">n</span><span class="p">]</span> <span class="o">.=</span> <span class="nb">false</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">vec</span><span class="p">(</span><span class="n">isboundary</span><span class="p">);</span>

<span class="c"># forcing function / boundary values vector</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">vec</span><span class="p">(</span> <span class="n">f</span><span class="o">.</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="p">)</span>
<span class="n">b</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>   <span class="c"># assigned values</span>
</pre></div>
</div>
</div>
</div>
<p>Now, instead of using Kronecker products (followed by boundary modifications) to build the matrix <span class="math notranslate nohighlight">\(\bfA\)</span>, we define a function that applies <span class="math notranslate nohighlight">\(\bfA\)</span> using the Sylvester form of the problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Apply Laplacian operator with Dirichlet condition.</span>
<span class="k">function</span> <span class="n">laplacian</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">AV</span> <span class="o">=</span> <span class="n">Dxx</span><span class="o">*</span><span class="n">V</span> <span class="o">+</span> <span class="n">V</span><span class="o">*</span><span class="n">Dyy</span><span class="o">&#39;</span>
    <span class="n">AV</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">.=</span> <span class="n">V</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>   <span class="c"># Dirichlet condition</span>
    <span class="k">return</span> <span class="n">vec</span><span class="p">(</span><span class="n">AV</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">using</span> <span class="n">Krylov</span><span class="p">,</span><span class="n">LinearMaps</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">LinearMap</span><span class="p">(</span><span class="n">laplacian</span><span class="p">,(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2501×2501 LinearMaps.FunctionMap{Float64}(laplacian; ismutating=false, issymmetric=false, ishermitian=false, isposdef=false)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">u</span><span class="p">,</span><span class="n">stats</span> <span class="o">=</span> <span class="n">gmres</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">rtol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
<span class="n">stats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Simple stats
 niter: 176
 solved: true
 inconsistent: false
 residuals: []
 Aresiduals: []
 κ₂(A): []
 status: solution good enough given atol and rtol
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Plots</span>
<span class="c"># plotlyjs()</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">U</span><span class="o">&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="ss">:viridis</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s">&quot;Solution of Poisson&#39;s equation&quot;</span><span class="p">,</span>      
    <span class="n">xaxis</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">),</span><span class="n">yaxis</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">),</span><span class="n">zaxis</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;u(x,y)&quot;</span><span class="p">))</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: using Plots.grid in module Main conflicts with an existing identifier.
</pre></div>
</div>
<img alt="../_images/iterative_8_1.svg" src="../_images/iterative_8_1.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,(</span><span class="n">U</span><span class="o">-</span><span class="n">g</span><span class="o">.</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span><span class="o">&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="ss">:viridis</span><span class="p">,</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s">&quot;Error&quot;</span><span class="p">,</span>      
    <span class="n">xaxis</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">),</span><span class="n">yaxis</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">),</span><span class="n">zaxis</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;u(x,y)&quot;</span><span class="p">),</span>
    <span class="n">right_margin</span><span class="o">=</span><span class="mi">3</span><span class="n">Plots</span><span class="o">.</span><span class="n">mm</span><span class="p">,</span><span class="n">camera</span><span class="o">=</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>   
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/iterative_9_0.svg" src="../_images/iterative_9_0.svg" /></div>
</div>
<p>Note that while the Laplacian operator is nominally symmetric and negative definite, boundary conditions can wreck that structure.</p>
</section>
<section id="preconditioning">
<h2>Preconditioning<a class="headerlink" href="#preconditioning" title="Permalink to this headline">#</a></h2>
<p>Krylov methods converge at a rate that depends strongly on the underlying linear operator. For symmetric matrices, the dependence can be characterized in terms of the spectrum of the matrix. When the ratio between the eigenvalues farthest from and closest to the origin is very large, the convergence becomes unacceptably slow.</p>
<p>In the case of Poisson’s equation, a second-order FD method produces a matrix with condition number <span class="math notranslate nohighlight">\(O(h^{-2})\)</span> when using grid spacing <span class="math notranslate nohighlight">\(h\)</span>, and the number of MINRES or CG iterations grows as <span class="math notranslate nohighlight">\(O(h^{-1})\)</span>.</p>
<p>The best response is to use a <strong>preconditioner</strong>, which is a way to apply an approximate solution process to improve the convergence rate to the actual solution. For example, if one uses a recursive coarsening procedure to approximate the original FD method, the result is a <em>multigrid</em> preconditioner that can provide convergence in <span class="math notranslate nohighlight">\(O(1)\)</span> iterations in ideal circumstances. Another approach is to decompose the domain into pieces and simplify or ignore the interactions between them.</p>
</section>
<section id="newton-krylov-methods">
<h2>Newton–Krylov methods<a class="headerlink" href="#newton-krylov-methods" title="Permalink to this headline">#</a></h2>
<p>In a nonlinear problem, we have an <em>outer iteration</em> of changing linear problems for the nonlinear part, and an <em>inner iteration</em> of a Krylov method to solve the linear part. Typically one starts the inner iterations with a rather large error tolerance, since finding accurate values for a bad solution to the nonlinear problem is a waste of time. This tolerance decreases as the outer iteration homes in on the solution of the nonlinear problem. Even so, the Newton corrections need be found accurately relative to the outer solution only.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "tobydriscoll/fd-spectral-notes",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.8"
        },
        kernelOptions: {
            kernelName: "julia-1.8",
            path: "./elliptic"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.8'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="poisson.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">3.2. </span>Solving the Poisson equation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="disk.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3.4. </span>Discretizing the disk</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Tobin A. Driscoll<br/>
  
      &copy; Copyright 2022.<br/>
    <div class="extra_footer">
      <img alt='UD logo' src='_static/UDlogo-small.png'>
    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>